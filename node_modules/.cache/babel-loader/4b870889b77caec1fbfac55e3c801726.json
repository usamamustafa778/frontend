{"ast":null,"code":"import _asyncToGenerator from\"/Users/usamabhatti/Documents/amazona/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/usamabhatti/Documents/amazona/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/usamabhatti/Documents/amazona/frontend/node_modules/@babel/runtime/regenerator/index.js\";import axios from'axios';import React,{useContext,useEffect,useRef,useState}from'react';import{LoadScript,GoogleMap,StandaloneSearchBox,Marker}from'@react-google-maps/api';import{useNavigate}from'react-router-dom';import{Store}from'../Store';import Button from'react-bootstrap/Button';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var defaultLocation={lat:45.516,lng:-73.56};var libs=['places'];export default function MapScreen(){var _useContext=useContext(Store),state=_useContext.state,ctxDispatch=_useContext.dispatch;var userInfo=state.userInfo;var navigate=useNavigate();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),googleApiKey=_useState2[0],setGoogleApiKey=_useState2[1];var _useState3=useState(defaultLocation),_useState4=_slicedToArray(_useState3,2),center=_useState4[0],setCenter=_useState4[1];var _useState5=useState(center),_useState6=_slicedToArray(_useState5,2),location=_useState6[0],setLocation=_useState6[1];var mapRef=useRef(null);var placeRef=useRef(null);var markerRef=useRef(null);var getUserCurrentLocation=function getUserCurrentLocation(){if(!navigator.geolocation){alert('Geolocation os not supported by this browser');}else{navigator.geolocation.getCurrentPosition(function(position){setCenter({lat:position.coords.latitude,lng:position.coords.longitude});setLocation({lat:position.coords.latitude,lng:position.coords.longitude});});}};useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios('/api/keys/google',{headers:{Authorization:\"BEARER \".concat(userInfo.token)}});case 2:_yield$axios=_context.sent;data=_yield$axios.data;setGoogleApiKey(data.key);getUserCurrentLocation();case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetch(){return _ref.apply(this,arguments);};}();fetch();ctxDispatch({type:'SET_FULLBOX_ON'});},[ctxDispatch,userInfo]);var onLoad=function onLoad(map){mapRef.current=map;};var onIdle=function onIdle(){setLocation({lat:mapRef.current.center.lat(),lng:mapRef.current.center.lng()});};var onLoadPlaces=function onLoadPlaces(place){placeRef.current=place;};var onPlacesChanged=function onPlacesChanged(){var place=placeRef.current.getPlaces()[0].geometry.location;setCenter({lat:place.lat(),lng:place.lng()});setLocation({lat:place.lat(),lng:place.lng()});};var onMarkerLoad=function onMarkerLoad(marker){markerRef.current=marker;};var onConfirm=function onConfirm(){var places=placeRef.current.getPlaces()||[{}];ctxDispatch({type:'SAVE_SHIPPING_ADDRESS_MAP_LOCATION',payload:{lat:location.lat,lng:location.lng,address:places[0].formatted_address,name:places[0].name,vicinity:places[0].vicinity,googleAddressId:places[0].id}});toast.success('location selected successfully.');navigate('/shipping');};return/*#__PURE__*/_jsx(\"div\",{className:\"full-box\",children:/*#__PURE__*/_jsx(LoadScript,{libraries:libs,googleMapsApiKey:googleApiKey,children:/*#__PURE__*/_jsxs(GoogleMap,{id:\"sample-map\",mapContainerStyle:{height:'100%',width:'100%'},center:center,zoom:15,onLoad:onLoad,onIdle:onIdle,children:[/*#__PURE__*/_jsx(StandaloneSearchBox,{onLoad:onLoadPlaces,onPlacesChanged:onPlacesChanged,children:/*#__PURE__*/_jsxs(\"div\",{className:\"map-input-box\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Enter your address\"}),/*#__PURE__*/_jsx(Button,{type:\"button\",onClick:onConfirm,children:\"Confirm\"})]})}),/*#__PURE__*/_jsx(Marker,{position:location,onLoad:onMarkerLoad})]})})});}","map":{"version":3,"names":["axios","React","useContext","useEffect","useRef","useState","LoadScript","GoogleMap","StandaloneSearchBox","Marker","useNavigate","Store","Button","toast","defaultLocation","lat","lng","libs","MapScreen","state","ctxDispatch","dispatch","userInfo","navigate","googleApiKey","setGoogleApiKey","center","setCenter","location","setLocation","mapRef","placeRef","markerRef","getUserCurrentLocation","navigator","geolocation","alert","getCurrentPosition","position","coords","latitude","longitude","fetch","headers","Authorization","token","data","key","type","onLoad","map","current","onIdle","onLoadPlaces","place","onPlacesChanged","getPlaces","geometry","onMarkerLoad","marker","onConfirm","places","payload","address","formatted_address","name","vicinity","googleAddressId","id","success","height","width"],"sources":["/Users/usamabhatti/Documents/amazona/frontend/src/screens/MapScreen.js"],"sourcesContent":["import axios from 'axios';\nimport React, { useContext, useEffect, useRef, useState } from 'react';\nimport {\n    LoadScript,\n    GoogleMap,\n    StandaloneSearchBox,\n    Marker,\n} from '@react-google-maps/api';\nimport { useNavigate } from 'react-router-dom';\nimport { Store } from '../Store';\nimport Button from 'react-bootstrap/Button';\nimport { toast } from 'react-toastify';\n\nconst defaultLocation = { lat: 45.516, lng: -73.56 };\nconst libs = ['places'];\n\nexport default function MapScreen() {\n    const { state, dispatch: ctxDispatch } = useContext(Store);\n    const { userInfo } = state;\n    const navigate = useNavigate();\n    const [googleApiKey, setGoogleApiKey] = useState('');\n    const [center, setCenter] = useState(defaultLocation);\n    const [location, setLocation] = useState(center);\n\n    const mapRef = useRef(null);\n    const placeRef = useRef(null);\n    const markerRef = useRef(null);\n\n    const getUserCurrentLocation = () => {\n        if (!navigator.geolocation) {\n            alert('Geolocation os not supported by this browser');\n        } else {\n            navigator.geolocation.getCurrentPosition((position) => {\n                setCenter({\n                    lat: position.coords.latitude,\n                    lng: position.coords.longitude,\n                });\n                setLocation({\n                    lat: position.coords.latitude,\n                    lng: position.coords.longitude,\n                });\n            });\n        }\n    }\n\n    useEffect(() => {\n        const fetch = async () => {\n            const { data } = await axios('/api/keys/google', {\n                headers: { Authorization: `BEARER ${userInfo.token}` },\n            });\n\n            setGoogleApiKey(data.key);\n            getUserCurrentLocation();\n        };\n\n        fetch();\n\n        ctxDispatch({ type: 'SET_FULLBOX_ON' });\n    }, [ctxDispatch, userInfo]);\n\n    const onLoad = (map) => {\n        mapRef.current = map;\n    };\n\n    const onIdle = () => {\n        setLocation({\n            lat: mapRef.current.center.lat(),\n            lng: mapRef.current.center.lng(),\n        });\n    };\n\n    const onLoadPlaces = (place) => {\n        placeRef.current = place;\n    };\n\n    const onPlacesChanged = () => {\n        const place = placeRef.current.getPlaces()[0].geometry.location;\n        setCenter({ lat: place.lat(), lng: place.lng() });\n        setLocation({ lat: place.lat(), lng: place.lng() });\n    };\n\n    const onMarkerLoad = (marker) => {\n        markerRef.current = marker;\n    };\n\n    const onConfirm = () => {\n        const places = placeRef.current.getPlaces() || [{}];\n        ctxDispatch({\n            type: 'SAVE_SHIPPING_ADDRESS_MAP_LOCATION',\n            payload: {\n                lat: location.lat,\n                lng: location.lng,\n                address: places[0].formatted_address,\n                name: places[0].name,\n                vicinity: places[0].vicinity,\n                googleAddressId: places[0].id,\n            },\n        });\n\n        toast.success('location selected successfully.');\n        navigate('/shipping');\n    };\n\n    return (\n        <div className=\"full-box\">\n            <LoadScript libraries={libs} googleMapsApiKey={googleApiKey}>\n                <GoogleMap\n                    id=\"sample-map\"\n                    mapContainerStyle={{ height: '100%', width: '100%' }}\n                    center={center}\n                    zoom={15}\n                    onLoad={onLoad}\n                    onIdle={onIdle}\n                >\n                    <StandaloneSearchBox\n                        onLoad={onLoadPlaces}\n                        onPlacesChanged={onPlacesChanged}\n                    >\n                        <div className=\"map-input-box\">\n                            <input type=\"text\" placeholder=\"Enter your address\"></input>\n                            <Button type=\"button\" onClick={onConfirm}>\n                                Confirm\n                            </Button>\n                        </div>\n                    </StandaloneSearchBox>\n                    <Marker position={location} onLoad={onMarkerLoad}></Marker>\n                </GoogleMap>\n            </LoadScript>\n        </div>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}